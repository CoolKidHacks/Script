-- ================= INITIAL DELAY =================
task.wait(5) -- Wait 5 seconds before running the rest of the script

-- ================= CONFIG =================
local TARGET_PLACE_ID = 129604661913557
local COLLECT_RANGE = 500
local collectHealth = true
local collectAmmo = true

-- ================= SERVICES =================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local GuiService = game:GetService("GuiService")

local LocalPlayer = Players.LocalPlayer

-- ================= REMOTES =================
local ArcadeRemotes = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Arcade")
local DuelsRemotes = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Duels")

local teleportArgs = {
    [1] = "arc_freeforall"
}

-- ================= STAFF DETECTOR CODE =================
local STAFF_CODE = [[
shared.StaffDetectorLoading = false
autoload = true
loadstring(game:HttpGetAsync(
    "https://raw.githubusercontent.com/Ukrubojvo/Modules/main/StaffDetector.lua"
))()
]]

local function loadStaffDetector()
    pcall(function()
        shared.StaffDetectorLoading = false
        autoload = true
        loadstring(game:HttpGetAsync(
            "https://raw.githubusercontent.com/Ukrubojvo/Modules/main/StaffDetector.lua"
        ))()
    end)
end

-- Load immediately
loadStaffDetector()

-- Queue on teleport / serverhop
local queue =
    (syn and syn.queue_on_teleport)
    or queue_on_teleport
    or (fluxus and fluxus.queue_on_teleport)

if queue then
    queue(STAFF_CODE)
end

-- ================= AUTO RECONNECT ON KICK =================
pcall(function()
    GuiService.ErrorMessageChanged:Connect(function(msg)
        if msg and msg ~= "" then
            if queue then
                queue(STAFF_CODE)
            end
            task.wait(1)
            pcall(function()
                TeleportService:Teleport(game.PlaceId, LocalPlayer)
            end)
        end
    end)
end)

-- ================= NOT TARGET PLACE: SPAM TELEPORT =================
if game.PlaceId ~= TARGET_PLACE_ID then
    task.spawn(function()
        while game.PlaceId ~= TARGET_PLACE_ID do
            pcall(function()
                ArcadeRemotes.TeleportToArcadeServer:InvokeServer(unpack(teleportArgs))
            end)
            task.wait(0.5)
        end
    end)
    return
end

-- ================= TARGET PLACE LOGIC =================

-- JOIN ARCADE EVERY 1.7s
task.spawn(function()
    while true do
        pcall(function()
            ArcadeRemotes.Join:FireServer()
        end)
        task.wait(1.7)
    end
end)

-- RESPAWN EVERY 1.7s
task.spawn(function()
    while true do
        pcall(function()
            DuelsRemotes.RespawnNow:FireServer()
        end)
        task.wait(1.7)
    end
end)

-- ================= FIRETOUCH AUTO COLLECT =================
RunService.RenderStepped:Connect(function()
    local character = LocalPlayer.Character
    if not character then return end

    local hrp = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChild("Humanoid")
    if not hrp or not humanoid then return end

    local needsHealth = humanoid.Health < humanoid.MaxHealth

    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("BasePart") and obj.Name == "_drop" then
            local distance = (hrp.Position - obj.Position).Magnitude
            if distance <= COLLECT_RANGE then
                if (collectHealth and obj:FindFirstChild("Health") and needsHealth)
                or (collectAmmo and obj:FindFirstChild("Ammo")) then
                    firetouchinterest(hrp, obj, 0)
                    firetouchinterest(hrp, obj, 1)
                end
            end
        end
    end
end)
